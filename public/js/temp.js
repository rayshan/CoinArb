// Generated by CoffeeScript 1.6.3
(function() {
  var legend;

  legend = function(g) {
    g.each(function() {
      var items, lBox, lItems, lbbox, legendPadding, svg;
      items = {};
      g = d3.select(this);
      svg = d3.select(g.property("nearestViewportElement"));
      legendPadding = g.attr("data-style-padding") || 5;
      lBox = g.selectAll(".box").data([true]);
      lItems = g.selectAll(".items").data([true]);
      lBox.enter().append("rect").classed("box", true);
      lItems.enter().append("g").classed("items", true);
      svg.selectAll("[data-legend]").each(function() {
        var self;
        self = d3.select(this);
        return items[self.attr("data-legend")] = {
          pos: self.attr("data-legend-pos") || this.getBBox().y,
          color: self.attr("data-legend-color") || (self.style("fill") !== "none" ? self.style("fill") : self.style("stroke"))
        };
      });
      items = d3.entries(items).sort(function(a, b) {
        return a.value.pos - b.value.pos;
      });
      lItems.selectAll("text").data(items, function(d) {
        return d.key;
      }).call(function(d) {
        return d.enter().append("text");
      }).call(function(d) {
        return d.exit().remove();
      }).attr("y", function(d, i) {
        return i + "em";
      }).attr("x", "1em").text(function(d) {
        return d.key;
      });
      lItems.selectAll("circle").data(items, function(d) {
        return d.key;
      }).call(function(d) {
        return d.enter().append("circle");
      }).call(function(d) {
        return d.exit().remove();
      }).attr("cy", function(d, i) {
        return i - 0.25 + "em";
      }).attr("cx", 0).attr("r", "0.4em").style("fill", function(d) {
        return d.value.color;
      });
      lbbox = lItems[0][0].getBBox();
      return lBox.attr("x", lbbox.x - legendPadding).attr("y", lbbox.y - legendPadding).attr("height", lbbox.height + 2 * legendPadding).attr("width", lbbox.width + 2 * legendPadding);
    });
    return g;
  };

}).call(this);

/*
//@ sourceMappingURL=temp.map
*/
